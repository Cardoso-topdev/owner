<?php

add_image_size( 'leadership_image', 300, 260, true );
add_image_size( 'leadership_image_2x', 600, 520, true );

add_image_size( 'news_image', 400, 300, true );
add_image_size( 'news_image_2x', 800, 600, true );

add_image_size( 'testimonial_image', 412, 276, true );
add_image_size( 'testimonial_image_2x', 824, 552, true );

add_image_size( 'grid_image', 440, 0, true );
add_image_size( 'grid_image_2x', 880, 0, true );

add_image_size( 'blog_image', 349, 234, true );
add_image_size( 'blog_image_2x', 698, 468, true );

add_image_size( 'blog_single_image', 1110, 345, true );
add_image_size( 'blog_single_image_2x', 2220, 690, true );

add_image_size( 'hero-img', 825, 631, true );
add_image_size( 'hero-img-2x', 1650, 1262, true );
add_image_size( 'hero-mobile-img', 375, 407, true );
add_image_size( 'hero-mobile-img-2x', 750, 814, true );

add_image_size( 'content-block-img', 597, 577, false );
add_image_size( 'content-block-img-2x', 1194, 1154, false );
add_image_size( 'content-block-mobile-img', 375, 443, false );
add_image_size( 'content-block-mobile-img-2x', 750, 886, false );

add_image_size( 'video-poster-img', 616, 447, true );
add_image_size( 'video-poster-img-2x', 1232, 894, true );

add_image_size( 'story-slider-featured-img', 657, 478, true );
add_image_size( 'story-slider-featured-img-2x', 1314, 956, true );

add_image_size( 'story-slider-person-img', 60, 60, false );
add_image_size( 'story-slider-person-img-2x', 120, 120, false );

add_image_size( 'meet-the-foundter-img', 409, 410, false );
add_image_size( 'meet-the-foundter-img-2x', 818, 820, false );

add_image_size( 'testimonial-slider-person-img', 74, 74, false );
add_image_size( 'testimonial-slider-person-img-2x', 148, 148, false );

add_image_size( 'lead-form-img', 348, 314, true );
add_image_size( 'lead-form-img-2x', 696, 628, true );

add_image_size( 'seen-in', 422, 9999 );
add_image_size( 'seen-in-2x', 844, 9999);

add_image_size( 'image-grid', 581, 463, true );
add_image_size( 'image-grid-2x', 1162, 926, true);

add_image_size( 'header-landing', 1184, 918, true );
add_image_size( 'header-landing-2x', 2368, 1836, true);

add_image_size( 'video-slider', 287, 400, true );
add_image_size( 'video-slider-2x', 573, 800, true);

add_image_size( 'contact-image', 339, 472, true );
add_image_size( 'contact-image-2x', 677, 944, true);
add_image_size( 'contact-image-m', 268, 192, true);

add_image_size( 'story-small', 52, 52, true );
add_image_size( 'story-small-2x', 104, 104, true);
add_image_size( 'story', 575, 542, true );
add_image_size( 'story-2x', 1149, 1084, true);

add_image_size( 'ci', 666, 673, true );
add_image_size( 'ci-2x', 1332, 1345, true);

add_image_size( 'ci-1', 759, 833, true );
add_image_size( 'ci-1-2x', 1518, 1666, true);
add_image_size( 'ci-1-m-2x', 326, 357, true);

add_image_size( 'ci-2', 350, 530, true );
add_image_size( 'ci-2-2x', 712, 1063, true);
add_image_size( 'ci-2-m-2x', 241, 359, true);

add_image_size( 'ci-3', 803, 880, true );
add_image_size( 'ci-3-2x', 1605, 1758, true);
add_image_size( 'ci-3-m-2x', 375, 411, true);

add_image_size( 'ci-4', 933, 1002, true );
add_image_size( 'ci-4-2x', 1865, 2004, true);
add_image_size( 'ci-4-m-2x', 375, 456, true);

add_image_size( 'ci-5', 533, 345, true );
add_image_size( 'ci-5-2x', 1065, 690, true);

add_image_size( 'ci-6', 525, 378, true );
add_image_size( 'ci-6-2x', 1050, 756, true);
add_image_size( 'ci-7', 552, 363, true );
add_image_size( 'ci-7-2x', 1103, 725, true);

add_image_size( 'ci-8', 455, 263, true );
add_image_size( 'ci-8-2x', 910, 527, true);
add_image_size( 'ci-9', 425, 223, true );
add_image_size( 'ci-9-2x', 850, 446, true);

add_image_size( 'ci-10', 479, 289, true );
add_image_size( 'ci-10-2x', 957, 576, true);
add_image_size( 'ci-11', 322, 182, true );
add_image_size( 'ci-11-2x', 643, 363, true);

add_image_size( 'ci-12', 1105, 780, true );
add_image_size( 'ci-12-2x', 2210, 1560, true);

add_image_size( 'ci-13', 931, 973, true );
add_image_size( 'ci-13-2x', 1862, 1954, true);

add_image_size( 'ci-14', 979, 614, true );
add_image_size( 'ci-14-2x', 1957, 1228, true);

add_image_size( 'ci-15', 883, 867, true );
add_image_size( 'ci-15-2x', 1766, 1732, true);

add_image_size( 'ci-16', 844, 799, true );
add_image_size( 'ci-16-2x', 1687, 1598, true);

add_image_size( 'ci-17', 875, 890, true );
add_image_size( 'ci-17-2x', 1749, 1780, true);

add_image_size( 'ci-18', 999, 906, true );
add_image_size( 'ci-18-2x', 1998, 1811, true);

add_image_size( 'ci-19', 544, 671, true );
add_image_size( 'ci-19-2x', 1086, 1340, true);

add_image_size( 'guides', 140, 867, true );
add_image_size( 'guides-2x', 280, 240, true);

function wp_get_attachment( $attachment_id ) {

	$attachment = get_post( $attachment_id );
	return array(
		'alt' => get_post_meta( $attachment->ID, '_wp_attachment_image_alt', true ),
		'caption' => $attachment->post_excerpt,
		'description' => $attachment->post_content,
		'href' => get_permalink( $attachment->ID ),
		'src' => $attachment->guid,
		'title' => $attachment->post_title
	);
}

define('API_KEY', '599c5b69a43dc93d492c903c484caa20234664e07bcd3c196b6f8f7b6283dc1817c8b9a0');
define('CONTACT_ENDPOINT', 'https://placepull.api-us1.com/api/3/contacts');
define('CUSTOM_ENDPOINT', 'https://placepull.api-us1.com/api/3/fieldValues/');
define('CONTACT_TAG_ENDPOINT', 'https://placepull.api-us1.com/api/3/contactTags');
define('SALESFORCE_ENDPOINT', 'https://profitbossinc.my.salesforce.com/services/data/v50.0/sobjects/Lead');

if (!is_admin()) {
	function wpb_search_filter($query) {
		if ($query->is_search) {
			$query->set('post_type', 'post');
		}
		return $query;
	}
	add_filter('pre_get_posts','wpb_search_filter');
}

// Header Menu
function clean_custom_menu($theme_location) {

    if (($theme_location) && ($locations = get_nav_menu_locations()) && isset($locations[$theme_location])) {

        $menu = get_term($locations[$theme_location], 'nav_menu');
        $menu_items = wp_get_nav_menu_items($menu->term_id);

        $menu_list = '';
        $count = 0;

        foreach ($menu_items as $menu_item) {
            $link = $menu_item->url;
            $title = $menu_item->title;

            $class_names = $value = '';

            $classes = empty($menu_item->classes) ? array() : (array) $menu_item->classes;

            $class_names = join(' ', apply_filters('nav_menu_css_class', array_filter($classes), $menu_item));

            if (!$menu_item->menu_item_parent) {
                $parent_id = $menu_item->ID;

                $menu_list .= '<li class="'.$class_names.'">' . "\n";
                $menu_list .= '<a class="anchor-link" href="' . $link . '">' . $title;
                $menu_list .= '</a>' . "\n";
            }

            if ($menu_items[$count + 1]->menu_item_parent != $parent_id) {
                $menu_list .= '</li>' . "\n";
            }

            $count++;
        }

    } else {
        $menu_list = '<!-- no menu defined in location "' . $theme_location . '" -->';
    }
    echo $menu_list;
}


/**
 * This function is for escaping strings
 * You can use it everywhere
 * Exmaple:
 * $phone = '+1 (758) 422-555-222';
 <a href="tel:<php echo am_esc($phone, 'phone'); ?>"><php echo $phone; ?></a>
 it will return <a href="tel:+1758422555222">+1 (758) 422-555-222</a>
 */
function am_esc($value, $esc){
	try {
		switch ($esc) :
			case 'url':
				$toReturn = esc_url($value);
				break;
			case 'attr':
				$toReturn = esc_attr($value);
				break;
			case 'html':
				$toReturn = esc_html($value);
				break;
			case 'email':
				// $hex_encoding = true
				$toReturn = antispambot($value, true);
				break;
			case 'email2':
				$toReturn = antispambot($value, false);
				break;
			case 'phone':
				$toReturn = str_replace(array('(', ')', ' ', '-', '.', ','), '', $value);
				break;
			case '':
				$toReturn = $value;
				break;
			default:
				throw new Exception();
				break;
		endswitch;
		return $toReturn;
	} catch (Exception $e) {
		$trace = $e->getTrace()[0];
		ob_clean();
		printf(
			__( "Invalid escaping type (%s) provided for am_esc() in %s on the line %s!", 'am' ),
			$esc,
			$trace['file'],
			$trace['line']
		);
		exit();
	}
}

add_action('wp_ajax_short_form_data_ac', 'short_form_data_ac');
add_action('wp_ajax_nopriv_short_form_data_ac', 'short_form_data_ac');
// submit the form Data
function short_form_data_ac(){
	
		if(empty($_POST['user_name'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter your first name'));
			wp_die();
		}
		if(empty($_POST['user_lname'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter your last name'));
			wp_die();
		}
		
		if(empty($_POST['your_email'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter your email'));
			wp_die();
		}
		// is it valid email
		if ( !is_email( $_POST['your_email'] ) ) {
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter valid email'));
			wp_die();
		}
		// make some validation
		if(empty($_POST['restaurant_name'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter resturant name.'));
			wp_die();
		}
		
	
		// get user data
		$email = sanitize_text_field($_POST['your_email']);
		//$name = sanitize_text_field($_POST['user_name']);
		$phone = (!empty($_POST['user_phone'])) ? sanitize_text_field($_POST['user_phone']) : '';
		
		$restaurant_name = (!empty($_POST['restaurant_name'])) ? sanitize_text_field($_POST['restaurant_name']) : 'Unknown';
		$redirect_success = (!empty($_POST['redirect_success'])) ? $_POST['redirect_success'] : '';
		$postal_code = (!empty($_POST['postal_code'])) ? $_POST['postal_code']: '';
		$country = (!empty($_POST['country'])) ? $_POST['country']: '';
		$firstname = $_POST['user_name'];
		$lastname = $_POST['user_lname'];

		$full_address = $postal_code;
		
		
		$form_data = array(
            'submittedAt' => round(microtime(true) * 1000),
            'fields' => array(
                array(
                    'name' => 'email',
                    'value' => $email
                ),
                array(
                    'name' => 'firstname',
                    'value' => $firstname
                ),
                array(
                    'name' => 'lastname',
                    'value' => !empty($lastname) ? $lastname : ''
                ),
                /*array(
                    'name' => 'mobilephone',
                    'value' => $phone
                ),*/
                array(
                    'name' => 'company',
                    'value' => $restaurant_name
                ),
                array(
                    'name' => 'phone',
                    'value' =>$phone
                ),
                array(
                    'name' => 'address',
                    'value' =>$full_address
                )
            ),
        );
		

        $response = wp_remote_post('https://api.hsforms.com/submissions/v3/integration/submit/6449395/04e23095-f92c-401d-81e4-d9e35a9c3b25', array(
            'headers' => array(
                'content-type' => 'application/json',
            ),
            'body' => wp_json_encode($form_data),
            'method' => 'POST',
            'data_format' => 'body',
        ));
        //var_dump($response);
        if (is_wp_error($response)) {
            $error_message = $response->get_error_message();
			// call sales data api to send data
		//	post_data_sales_force_api($sales_data);
		
            echo wp_json_encode(array('status'=>'error', 'redirect_success'=>'', 'message'=>$error_message));
			wp_die();
        } else {
            $body = wp_remote_retrieve_body($response);
            $data = json_decode($body);
			/*echo '<pre>';
			print_r( $data);
			die;*/
            echo wp_json_encode(array('status'=>'success', 'redirect_success'=>$redirect_success, 'message'=>'Successfully done'));
			wp_die();
        }
}


add_action('wp_ajax_submit_data_to_active_campaing', 'submit_data_to_active_campaing');
add_action('wp_ajax_nopriv_submit_data_to_active_campaing', 'submit_data_to_active_campaing');
// submit the form Data
function submit_data_to_active_campaing(){
	// is poll is submit
	//if(!empty($_POST['place_id'])){
		$place_id = sanitize_text_field($_POST['place_id']);
		// make some validation
		if(empty($_POST['search_restaurant_name'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please select a business location from the search results.'));
			wp_die();
		}
		
		// make some validation
		if(empty($_POST['user_name'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter your first name'));
			wp_die();
		}
		if(empty($_POST['user_lname'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter your last name'));
			wp_die();
		}
		
		if(empty($_POST['your_email'])){
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter your email'));
			wp_die();
		}
		// is it valid email
		if ( !is_email( $_POST['your_email'] ) ) {
			echo wp_json_encode(array('status'=>'error', 'message'=>'Please enter valid email'));
			wp_die();
		}
		// get user data
		$email = sanitize_text_field($_POST['your_email']);
		//$name = sanitize_text_field($_POST['user_name']);
		$phone = (!empty($_POST['user_phone'])) ? sanitize_text_field($_POST['user_phone']) : '';
		$place_id = (!empty($_POST['place_id'])) ? sanitize_text_field($_POST['place_id']) : '';
		$restaurant_address = (!empty($_POST['restaurant_address'])) ? sanitize_text_field($_POST['restaurant_address']) : '';
		$restaurant_phone = (!empty($_POST['restaurant_phone'])) ? sanitize_text_field($_POST['restaurant_phone']) : '';
		$restaurant_name = (!empty($_POST['restaurant_name'])) ? sanitize_text_field($_POST['restaurant_name']) : 'Unknown';
		$redirect_success = (!empty($_POST['redirect_success'])) ? $_POST['redirect_success'] : '';
		$city = (!empty($_POST['resturant_city'])) ? $_POST['resturant_city']: '';
		$state = (!empty($_POST['resturant_state'])) ? $_POST['resturant_state']: '';
		$postal_code = (!empty($_POST['postal_code'])) ? $_POST['postal_code']: '';
		$country = (!empty($_POST['country'])) ? $_POST['country']: '';
		$firstname = $_POST['user_name'];
		$lastname = $_POST['user_lname'];

		$full_address = rtrim($full_address, ',');
		
		
		$form_data = array(
            'submittedAt' => round(microtime(true) * 1000),
            'fields' => array(
                array(
                    'name' => 'email',
                    'value' => $email
                ),
                array(
                    'name' => 'firstname',
                    'value' => $firstname
                ),
                array(
                    'name' => 'lastname',
                    'value' => !empty($lastname) ? $lastname : ''
                ),
                /*array(
                    'name' => 'mobilephone',
                    'value' => $phone
                ),*/
				array(
                    'name' => 'phone',
                    'value' => $phone
                ),
                array(
                    'name' => 'company',
                    'value' => $restaurant_name
                ),
                array(
                    'name' => 'phone',
                    'value' =>$restaurant_phone
                ),
                array(
                    'name' => 'address',
                    'value' =>$full_address
                ),
                array(
                    'name' => 'city',
                    'value' => $city
                ),
				array(
                    'name' => 'state',
                    'value' => $state
                ),
				array(
                    'name' => 'country',
                    'value' => $country
                ),
            ),
           // 'context' => array('hutk' => (isset($_COOKIE['hubspotutk']) && !empty($_COOKIE['hubspotutk'])) ? $_COOKIE['hubspotutk'] : '')
        );
		// old form ID
		//$form_id = 'b37aab8d-feaf-430c-8137-f7cf8be2d425';
		// owner form ID home
		$form_id = 'b37aab8d-feaf-430c-8137-f7cf8be2d425';
		

        $response = wp_remote_post('https://api.hsforms.com/submissions/v3/integration/submit/6449395/'.$form_id, array(
            'headers' => array(
                'content-type' => 'application/json',
            ),
            'body' => wp_json_encode($form_data),
            'method' => 'POST',
            'data_format' => 'body',
        ));
        //var_dump($response);
        if (is_wp_error($response)) {
            $error_message = $response->get_error_message();
			// call sales data api to send data
		//	post_data_sales_force_api($sales_data);
		
            echo wp_json_encode(array('status'=>'error', 'redirect_success'=>'', 'message'=>$error_message));
			wp_die();
        } else {
            $body = wp_remote_retrieve_body($response);
            $data = json_decode($body);
			// call sales data api to send data
			//post_data_sales_force_api($sales_data);
			/*echo '<pre>';
			print_r( $data);*/
            echo wp_json_encode(array('status'=>'success', 'redirect_success'=>$redirect_success, 'message'=>'Successfully done'));
			wp_die();
        }
}
//post data to salesforce API
function post_data_sales_force_api($post_data = array()){
	
	if(empty($post_data)){
		return false;
	}
	/*echo '<pre>';
	print_r($post_data);
	die;*/
	// get new accessToken
	$acess_token = get_salesforce_access_token();
	if(!$acess_token){
		return false;
	}
	$response = wp_remote_post(SALESFORCE_ENDPOINT, array(
			'headers'     => array(
				'Content-Type'=>'application/json',
				'Authorization'=>' Bearer '.$acess_token
			),
			'body'        => wp_json_encode($post_data),
			'method'      => 'POST',
			'data_format' => 'body',
		));	
					
		if ( is_wp_error( $response ) ) {
			$error_message = $response->get_error_message();
			return false;
		} else {				
			$body = wp_remote_retrieve_body( $response );
			$data = json_decode( $body );
			return true;
			/*echo 'Response:<pre>';
			print_r( $data );
			echo '</pre>';
			die();*/
		}
}

//add_action('init', 'get_salesforce_access_token');
function get_salesforce_access_token(){	
			// production credentials		
			$post_data =[
			'grant_type'=>'password',
			'client_id'=>'3MVG9kBt168mda_9x7JzmqLlsgp0UKcBCViN9Yt.kj31lUsY6I4e3aqIq_wbp3HNveOEG2xGf3UCuSeYASZnq',
			'client_secret'=>'77FB5B500B5B1BE7A4D5441329EE6B66FC451FA5E01FA72264828E417EC68697',
			'username'=>'integrationuser@profitboss.com',
			'password'=>'PB1U5F4cc7Pwd!GkyrnBXJqzVgiz3ITOaQ5eLNd'
			
			];
			$response = wp_remote_post('https://login.salesforce.com/services/oauth2/token', array(
							'headers'     => array(
								'Content-Type'=>'application/x-www-form-urlencoded',
							),
							'body'        => $post_data,
							'method'      => 'POST',
							'data_format' => 'body',
						));	
					
			if ( is_wp_error( $response ) ) {
				$error_message = $response->get_error_message();
				return false;
			} else {				
				$body = wp_remote_retrieve_body( $response );
				$data = json_decode( $body );
				if(isset($data->access_token)){
					return $data->access_token;
				}
				return false;
			}
			
}
// Create new Tag
function create_custom_page_tag($tag_name = '', $contact_id = ''){
	if('' == $tag_name){
		return false;
	}
	$tag_found = false;
	$response = wp_remote_get('https://placepull.api-us1.com/api/3/tags?search='.$tag_name,
				array(
					'headers'     => array(				
					'Api-Token'=> API_KEY
					),
				)
			);
	if ( is_wp_error( $response ) ) {
	 	 $error_message = $response->get_error_message();
		
	} else {
		$body = wp_remote_retrieve_body( $response );
		$result_data = json_decode( $body );
		if(isset($result_data->tags) && !empty($result_data->tags)){
			$tag_id = isset($result_data->tags[0]->id) ?  $result_data->tags[0]->id : '';
			if(!empty($tag_id)){
				$tag_found = true;
				add_contact_tag_landing($contact_id, $tag_id);
				return true;
				
			}
		}
		//echo '<pre>';
		//print_r($result_data);
		 
	}
	if(!$tag_found){
		$post_data = ['tag'=>array('tag'=>$tag_name, 'tagType'=>'contact', 'description'=>'form which landing page user submit the form')];
		
		$response2 = wp_remote_post('https://placepull.api-us1.com/api/3/tags', array(
				'headers'     => array(
					'Content-Type'=>'application/json',
					'Api-Token'=> API_KEY,
				),
				'body'        =>  json_encode($post_data),
				'method'      => 'POST',
				'data_format' => 'body',
			));	
			
			if ( is_wp_error( $response2 ) ) {
				$error_message = $response2->get_error_message();	
				return false;			
				
			} else {							
				$body = wp_remote_retrieve_body( $response2 );				
				$data2 = json_decode( $body );
				if(isset($data2->tag->id)){
					add_contact_tag_landing($contact_id, $data2->tag->id);
				}
				
			}
	}
}
// Add tag to contact list
function add_contact_tag_landing($contact_id = '', $tag_id = ''){
	
	if('' == $contact_id || ''== $tag_id){
		return false;
	}
	$post_data = ['contactTag'=>array('contact'=>$contact_id, 'tag'=>$tag_id)];
	$response2 = wp_remote_post(CONTACT_TAG_ENDPOINT, array(
			'headers'     => array(
				'Content-Type'=>'application/json',
				'Api-Token'=> API_KEY,
			),
			'body'        =>  json_encode($post_data),
			'method'      => 'POST',
			'data_format' => 'body',
		));	
		if ( is_wp_error( $response2 ) ) {
			$error_message = $response2->get_error_message();	
			return false;			
			
		} else {
			$body = wp_remote_retrieve_body( $response2 );				
			$data2 = json_decode( $body );
			return true;				
			
		}
	
}

/*
 * name: var_dump_pre
 * description: formated var_dump
 * 
 * */
function var_dump_pre( $var, $title='', $color = 'white', $dump = FALSE ){
	?>

	<?php
	$style = 'clear:both;overflow:auto;border:1px solid #BFBFBF; margin-top:10px; padding-left:3px;padding-bottom:3px;background-color:'.$color;
	echo '<div class="debug" style="'. $style .'" >';
	$db = debug_backtrace();
	//echo 'function: '.$db[0]['file'].' @ line:['.$db[0]['line'].']';
	$file  = strrev(implode(strrev(' /<span style="color:black">'), explode("/", strrev($db[0]['file']), 2)));
	$file .= '</span>'; 
	echo '<div style="width:100%; margin-left:-3px; color:#969696;background-color:#F0F0F0;padding:3px 0px 3px 3px"><small><span style="color:black">file: </span>'.$file.' <br />@<br /><span style="color:black">line:['.$db[0]['line'].']</span></small></div>';
	echo '<pre>';

	if( $title !='' )
		echo '<div style="width:100%; margin-left:-3px; background-color:#E5E5F8;padding:3px 0px 3px 3px"><strong>'.$title.':</strong></div><br />';
	
	if( $dump || is_bool( $var )){
		if( is_bool( $var )){
					
			switch ( $var ){
				case TRUE:
					echo '<span style="color:green">'; var_dump( $var ); echo '</span>';
				break;
				
				case FALSE:
					echo '<span style="color:red">'; var_dump( $var );echo '</span>';
				break;
			}
		}
		else
			var_dump( $var );
	}
	else
		print_r( $var );
	echo '</pre>';
	echo '</div>';
	echo '<div style="clear:both"></div>';
}

/**
 * Like get_template_part() put lets you pass args to the template file
 * Args are available in the tempalte as $template_args array
 * @param string filepart
 * @param mixed wp_args style argument list
 * https://wordpress.stackexchange.com/questions/176804/passing-a-variable-to-get-template-part
 */
function get_template_part_args( $file, $template_args = array(), $cache_args = array() ) {
    $template_args = wp_parse_args( $template_args );
    $cache_args = wp_parse_args( $cache_args );
    if ( $cache_args ) {
        foreach ( $template_args as $key => $value ) {
            if ( is_scalar( $value ) || is_array( $value ) ) {
                $cache_args[$key] = $value;
            } else if ( is_object( $value ) && method_exists( $value, 'get_id' ) ) {
                $cache_args[$key] = call_user_method( 'get_id', $value );
            }
        }
        if ( ( $cache = wp_cache_get( $file, serialize( $cache_args ) ) ) !== false ) {
            if ( ! empty( $template_args['return'] ) )
                return $cache;
            echo $cache;
            return;
        }
    }
    $file_handle = $file;
    do_action( 'start_operation', 'hm_template_part::' . $file_handle );
    if ( file_exists( get_stylesheet_directory() . '/' . $file . '.php' ) )
        $file = get_stylesheet_directory() . '/' . $file . '.php';
    elseif ( file_exists( get_template_directory() . '/' . $file . '.php' ) )
        $file = get_template_directory() . '/' . $file . '.php';
    ob_start();
    $return = require( $file );
    $data = ob_get_clean();
    do_action( 'end_operation', 'hm_template_part::' . $file_handle );
    if ( $cache_args ) {
        wp_cache_set( $file, $data, serialize( $cache_args ), 3600 );
    }
    if ( ! empty( $template_args['return'] ) )
        if ( $return === false )
            return false;
        else
            return $data;
    echo $data;
}

// add class to menu a link
add_filter('nav_menu_link_attributes', 'custom_nav_menu_link_attributes', 10, 4);
function custom_nav_menu_link_attributes($atts, $item, $args, $depth){
    if( $args->menu->term_id == 7 || $args->menu->term_id == 10 ){
        $class = ' depth-'.$depth ;
	    if( strpos( $item->url, "#" ) >= 0 && !in_array( 'menu-item-has-children', $item->classes ) ){
	        $class .= " anchor-link";
	    }
        $atts['class'] = (!empty($atts['class'])) ? $atts['class'].' '.$class : $class; 
    }
    return $atts;
}
